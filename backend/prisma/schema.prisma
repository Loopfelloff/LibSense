generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}

enum Roles {
  SUPERADMIN
  USER
}

enum Status {
  READING
  READ
  WILLREAD
}

model User {
  id                        String                    @id @default(uuid())
  first_name                String
  middle_name               String?
  last_name                 String
  email                     String                    @unique
  password                  String?
  provider_id               String?                   @unique
  profile_pic_link          String?
  user_role_id              String
  user_role                 UserRole                  @relation(fields: [user_role_id], references: [id])
  user_preferences          UserPreferences[]
  conversation_participants ConversationParticipant[]
  sent_messages             Message[]
  book_status_val           BookStatusVal[]
  favourites                Favourite[]
  review                    Review[]

  @@map("user")
}

model UserRole {
  id    String @id @default(uuid())
  role  Roles
  users User[]

  @@map("user_role")
}

model Genre {
  id               String            @id @default(uuid())
  genre_name       String
  user_preferences UserPreferences[]
  book_genres      BookGenres[]

  @@unique([genre_name])
  @@map("genre")
}

model BookGenres {
  id       String @id @default(uuid())
  book_id  String
  genre_id String
  book     Book   @relation(fields: [book_id], references: [id], onDelete: Cascade)
  genre    Genre  @relation(fields: [genre_id], references: [id], onDelete: Cascade)

  @@unique([book_id, genre_id])
}

model UserPreferences {
  id       String @id @default(uuid())
  user_id  String
  genre_id String
  user     User   @relation(fields: [user_id], references: [id], onDelete: Cascade)
  genre    Genre  @relation(fields: [genre_id], references: [id], onDelete: Cascade)

  @@unique([user_id, genre_id], name: "user_genre_preference")
}

model Conversation {
  id                        String                    @id @default(uuid())
  conversation_participants ConversationParticipant[]
  messages                  Message[]

  @@map("conversation")
}

model ConversationParticipant {
  id              String       @id @default(uuid())
  conversation_id String
  participant_id  String
  conversation    Conversation @relation(fields: [conversation_id], references: [id], onDelete: Cascade)
  user            User         @relation(fields: [participant_id], references: [id], onDelete: Cascade)

  @@unique([conversation_id, participant_id])
}

model Message {
  id              String       @id @default(uuid())
  conversation_id String
  sender_id       String
  message_body    String
  conversation    Conversation @relation(fields: [conversation_id], references: [id], onDelete: Cascade)
  sender          User         @relation(fields: [sender_id], references: [id], onDelete: Cascade)
  sent_date       DateTime     @default(now())

  @@map("message")
}

model Book {
  id               String          @id @default(uuid())
  isbn             String          @unique
  book_title       String
  book_cover_image String
  description      String
  avg_book_rating  Float @default(0)
  book_rating_count Float @default(0)
  book_written_by  BookWrittenBy[]
  favourites       Favourite[]
  review           Review[]
  book_genres      BookGenres[]
  user_statuses    BookStatusVal[]

  @@map("book")
}

model BookAuthor {
  id                 String          @id @default(uuid())
  author_first_name  String
  author_middle_name String?
  author_last_name   String
  book_written_by    BookWrittenBy[]

  @@map("book_author")
}

model BookWrittenBy {
  id             String     @id @default(uuid())
  book_author_id String
  book_id        String
  book           Book       @relation(fields: [book_id], references: [id], onDelete: Cascade)
  book_author    BookAuthor @relation(fields: [book_author_id], references: [id], onDelete: Cascade)

  @@unique([book_author_id, book_id])
}

model BookStatusVal {
  id      String @id @default(uuid())
  book_id String
  user_id String
  status  Status
  book    Book   @relation(fields: [book_id], references: [id], onDelete: Cascade)
  user    User   @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@unique([book_id, user_id], name: "user_book_status")
  @@map("book_status_val")
}

model Favourite {
  id      String @id @default(uuid())
  book_id String
  user_id String

  book Book @relation(fields: [book_id], references: [id], onDelete: Cascade)
  user User @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@unique([book_id, user_id], name: "user_book_favourite")
  @@map("favourite")
}

model Review {
  id          String @id @default(uuid())
  rating      Int
  review_body String
  user_id     String
  book_id     String

  book Book @relation(fields: [book_id], references: [id], onDelete: Cascade)
  user User @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@unique([book_id, user_id], name: "book_user_unique_review")
  @@map("review")
}
