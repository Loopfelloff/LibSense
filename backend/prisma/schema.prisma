generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model BookGenres {
  id       String @id
  book_id  String
  genre_id String
  book     book   @relation(fields: [book_id], references: [id], onDelete: Cascade)
  genre    genre  @relation(fields: [genre_id], references: [id], onDelete: Cascade)

  @@unique([book_id, genre_id])
}

model BookWrittenBy {
  id             String      @id @default(uuid())
  book_author_id String
  book_id        String
  book_author    book_author @relation(fields: [book_author_id], references: [id], onDelete: Cascade)
  book           book        @relation(fields: [book_id], references: [id], onDelete: Cascade)

  @@unique([book_author_id, book_id])
}

model ConversationParticipant {
  id              String       @id
  conversation_id String
  participant_id  String
  conversation    conversation @relation(fields: [conversation_id], references: [id], onDelete: Cascade)
  user            user         @relation(fields: [participant_id], references: [id], onDelete: Cascade)

  @@unique([conversation_id, participant_id])
}

model UserPreferences {
  id       String @id
  user_id  String
  genre_id String
  genre    genre  @relation(fields: [genre_id], references: [id], onDelete: Cascade)
  user     user   @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@unique([user_id, genre_id])
}

model book {
  id                String            @id @default(uuid())
  isbn              String            @unique
  book_title        String
  book_cover_image  String
  description       String
  avg_book_rating   Float             @default(0)
  book_rating_count Float             @default(0)
  BookGenres        BookGenres[]
  BookWrittenBy     BookWrittenBy[]
  book_status_val   book_status_val[]
  book_vector       book_vector?
  favourite         favourite[]
  review            review[]
  createdAt  DateTime @default(now())
}

model book_author {
  id                 String          @id @default(uuid())
  author_first_name  String
  author_last_name   String
  author_middle_name String?
  BookWrittenBy      BookWrittenBy[]
}

model book_status_val {
  id      String @id
  book_id String
  user_id String
  status  Status
  book    book   @relation(fields: [book_id], references: [id], onDelete: Cascade)
  user    user   @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@unique([book_id, user_id])
}

model book_vector {
  id         String                @id
  book_id    String                @unique
  embedding  Unsupported("vector")
  created_at DateTime?             @default(now()) @db.Timestamp(6)
  book       book                  @relation(fields: [book_id], references: [id], onDelete: Cascade)

  @@index([embedding], map: "book_vector_hnsw_idx")
}

model conversation {
  id                      String                    @id
  ConversationParticipant ConversationParticipant[]
  message                 message[]
}

model favourite {
  id      String @id
  book_id String
  user_id String
  book    book   @relation(fields: [book_id], references: [id], onDelete: Cascade)
  user    user   @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@unique([book_id, user_id])
}

model genre {
  id              String            @id
  genre_name      String            @unique
  BookGenres      BookGenres[]
  UserPreferences UserPreferences[]
}

model message {
  id              String       @id
  conversation_id String
  sender_id       String
  message_body    String
  sent_date       DateTime     @default(now())
  conversation    conversation @relation(fields: [conversation_id], references: [id], onDelete: Cascade)
  user            user         @relation(fields: [sender_id], references: [id], onDelete: Cascade)
}

model review {
  id          String @id
  rating      Int
  review_body String
  user_id     String
  book_id     String
  book        book   @relation(fields: [book_id], references: [id], onDelete: Cascade)
  user        user   @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@unique([book_id, user_id])
}

model user {
  id                      String                    @id
  first_name              String
  middle_name             String?
  last_name               String
  email                   String                    @unique
  password                String?
  profile_pic_link        String?
  user_role_id            String
  provider_id             String?                   @unique
  ConversationParticipant ConversationParticipant[]
  UserPreferences         UserPreferences[]
  book_status_val         book_status_val[]
  favourite               favourite[]
  message                 message[]
  review                  review[]
  user_role               user_role                 @relation(fields: [user_role_id], references: [id])
  user_vector             user_vector?
}

model user_role {
  id   String @id
  role Roles
  user user[]
}

model user_vector {
  id         String                @id
  user_id    String                @unique
  embedding  Unsupported("vector")
  created_at DateTime?             @default(now()) @db.Timestamp(6)
  user       user                  @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@index([embedding], map: "user_vector_hnsw_idx")
}

enum Roles {
  SUPERADMIN
  USER
}

enum Status {
  READING
  READ
  WILLREAD
}
